---
title: 'CDN Setup for Widget Bundles'
description: 'Configure CDN hosting for your 1fe widget bundles and static assets'
---

import {
  FcFlashOn,
  FcSettings,
  FcDeployment,
  FcGlobe,
} from "react-icons/fc";

<div style={{ 
  background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', 
  color: 'white', 
  padding: '2rem', 
  borderRadius: '12px', 
  marginBottom: '2rem',
  boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)'
}}>

### <FcFlashOn style={{ display: 'inline', marginRight: '0.5rem', verticalAlign: 'middle' }} /> CDN Service Overview

**Audience:** Platform teams setting up production CDN infrastructure for their organization.

Your 1fe widgets need to be served from a fast, reliable CDN to ensure optimal performance for users worldwide. This guide covers how to set up and configure CDN services for hosting your widget bundles.

</div>

## What Your CDN Will Host

### Widget Assets
- **JavaScript bundles** - Compiled widget code
- **CSS stylesheets** - Widget-specific styles
- **Source maps** - For debugging and error tracking
- **Asset files** - Images, fonts, icons used by widgets

## CDN Requirements

### Performance Requirements
- **Global edge locations** - Serve content from locations close to users
- **HTTP/2 support** - Modern protocol for efficient loading
- **Compression** - Gzip/Brotli compression for faster transfers
- **Caching policies** - Aggressive caching with proper invalidation

### Security Requirements
- **HTTPS only** - All content served over secure connections
- **CORS configuration** - Proper cross-origin resource sharing
- **Access controls** - Secure upload and deployment workflows
- **Content integrity** - Verify file integrity during delivery

## Akamai CDN Setup


### Why We Use Akamai

**Benefits for 1fe:**
- ‚ö° **Enterprise-grade performance** - Global edge network with excellent performance
- üõ°Ô∏è **Advanced security features** - DDoS protection, Web Application Firewall
- üìä **Real-time analytics** - Detailed performance and usage metrics
- üîó **API-first approach** - Excellent automation and CI/CD integration

### Detailed Akamai NetStorage Setup

**Official Documentation:** [Akamai NetStorage User Guide](https://techdocs.akamai.com/netstorage/docs)

Akamai NetStorage is a highly scalable and globally distributed cloud storage solution that acts as a reliable origin for your web assets. It integrates seamlessly with the Akamai CDN for fast and reliable content delivery.

:::note[Key Concepts]
- **Storage Group**: A logical container for your content that defines its storage location and replication settings.
- **Upload Directory**: A specific directory within a Storage Group where you upload your files. Each directory is assigned a unique CP Code (Content Provider Code) which is used to link it to your CDN configuration.
:::

:::note
NetStorage serves as the origin for your CDN. All widget bundles, assets, and manifests will be stored here and served globally through Akamai's edge network.
:::

#### Step 1: Create a NetStorage Storage Group

:::tip[Recommended Setup Order]
Follow these steps in order for the smoothest setup experience. Each step builds on the previous one.
:::

The first step is to create a new storage group. This is the foundation for your content storage.

**Follow these steps to create your NetStorage Storage Group:**

<div className="prose">
1. **Log in to Akamai Control Center**
   - Navigate to [Akamai Control Center](https://control.akamai.com/)

2. **Navigate to NetStorage**
   - Go to **Akamai** > **NetStorage**

3. **Start Creating Storage Group**
   - Click the **Create** button

4. **Select Storage Group Type**
   - Select **Create Storage Group** from the dropdown

5. **Set Storage Group Name**
   - **Storage Group Name**: Choose a unique and descriptive name (e.g., `1fe-Production`)

6. **Select Contract**
   - **Contract**: Select your specific contract from the dropdown

7. **Select Group**
   - **Group**: Select the group associated with your contract

8. **Configure Primary Replica**
   - **Replica No. 1**: Select a primary geographic zone (e.g., `us-east`)

9. **Set Failover Action**
   - **Failover Action**: Choose `spill outside` to ensure content is served from other replicas if the primary fails

10. **Configure Upload and Download Permissions**
    - Set **Allow upload** to `Yes`
    - Set **Allow download** to `Yes`

11. **Add Secondary Replica (Recommended)**
    - Click **Add Replica** to configure redundancy
    - Select a different geographic zone from the primary replica
    - This provides redundancy and improved global performance
    - **High Availability Requirement**: Always configure at least two replicas in different geographic zones for high availability. This ensures your content remains accessible even if one region experiences issues.

12. **Finalize Creation**
    - Click **Create Storage Group** to complete the process

13. **Verify Creation**
    - Verify the storage group appears in your NetStorage dashboard
    - Note the storage group details for future reference
</div>

**Official Documentation:** [Creating Storage Groups](https://techdocs.akamai.com/netstorage/docs/create-a-storage-group)

#### Step 2: Add an Upload Directory

Next, you will create a directory within your storage group for your content. This directory will be assigned a unique CP Code.

**Follow these steps to add an upload directory:**

<div className="prose">
1. **Navigate to NetStorage Storage Groups**
   - Go to **NetStorage** > **Storage Groups** page

2. **Select Your Storage Group**
   - Select the storage group you just created

3. **Access Upload Directories Section**
   - In the details pane, find the **Upload directories** section

4. **Start Creating New Directory**
   - Click the **+** icon to add a new directory

5. **Set Directory Name**
   - **Directory Name**: Enter a descriptive name (e.g., `production`)
   - This name becomes part of your file path structure
   - Choose names that clearly identify the environment or purpose

6. **Record the CP Code**
   - The system automatically assigns a unique **CP Code**
   - **Save this code immediately** - you'll need it for CDN configuration

7. **Store CP Code Securely**
   - Store the CP Code in a secure location accessible to your team

8. **Configure Download Security**
   - Set **Download security** to `All edge servers`
   - This allows global content delivery through the CDN

9. **Ensure Global Access**
   - This setting ensures your content can be served from all Akamai edge locations

10. **Complete Directory Creation**
    - Click **Create Directory** to finalize the configuration

11. **Verify Directory Creation**
    - Verify the directory appears in your Upload directories list
</div>

:::caution[Important: Save Your CP Code]
The CP Code is crucial for linking your NetStorage directory to your CDN property. **Write it down immediately** - you'll need it in Step 4 for CDN configuration.
:::

**Official Documentation:** [Adding Upload Directories](https://techdocs.akamai.com/netstorage/docs/add-an-upload-directory)

#### Step 3: Upload Content to NetStorage

With the storage configured, you can now upload your content using rsync over SSH for efficient and reliable file transfers.

**Follow these steps to upload content to NetStorage:**

<div className="prose">
1. **Access Storage Group Details**
   - From your Storage Group details, locate the **rsync domain name**

2. **Note Down Domain Name**
   - Example: `1fe.rsync.upload.akamai.com`
   - Record this domain as you'll use it in upload commands

3. **Navigate to Security Settings**
   - Go to the **Access & Security** tab in your Storage Group

4. **Configure SSH Key**
   - Retrieve or generate your NetStorage SSH key

5. **Set Key Permissions**
   - Ensure the key file has proper permissions (`chmod 600`)

6. **Store Key Securely**
   - Store the key securely for CI/CD use

7. **Prepare rsync Command**
   - Use rsync with SSH for efficient, secure file transfers

8. **Test with Dry Run**
   - Always test with `--dry-run` first to verify operations

9. **Review Command Structure**
   - Review the command structure and parameters before execution
</div>

:::tip[rsync Command Examples]
The rsync command uses specific flags for secure, efficient file transfers to NetStorage. For detailed command examples and scripts, see:

- **[1fe-ci-cd Repository](https://github.com/docusign/1fe-ci-cd)** - Complete CI/CD workflows and deployment scripts
- **[mock-cdn-assets Repository](https://github.com/docusign/mock-cdn-assets)** - Example asset structures and upload configurations
:::

**Complete the upload process with these final steps:**

<div className="prose">
10. **Review Dry Run Output**
    - Review the dry run output carefully to ensure expected operations

11. **Remove Dry Run Flag**
    - Once verified, remove the `--dry-run` flag from your command

12. **Execute Actual Upload**
    - Run the command again to perform the actual upload

13. **Monitor Upload Progress**
    - Monitor the upload progress and verify successful completion
</div>
:::tip[Complete Examples Available]
For complete rsync command examples and production-ready scripts, see the **[1fe-ci-cd repository](https://github.com/docusign/1fe-ci-cd)** which contains tested deployment workflows.
:::

**Official Documentation:** [Uploading Content to NetStorage](https://techdocs.akamai.com/netstorage/docs/upload-content)

#### Step 4: Configure an Akamai CDN Property

The final step is to create a CDN property to serve content from your NetStorage origin.

**Follow these steps to configure your Akamai CDN property:**

<div className="prose">
1. **Navigate to Property Manager**
   - Go to **Akamai** > **CDN** > **Property Manager** in the [Akamai Control Center](https://control.akamai.com/)

2. **Start New Property Creation**
   - Click **Create a New Property** to start the setup process

3. **Select Product and Contract**
   - Choose the appropriate product and contract for your property

4. **Add Hostname**
   - Add the **Hostname** for accessing your content (e.g., `assets.yourdomain.com`)

5. **Verify Domain Control**
   - Ensure the domain is under your control and DNS can be configured

6. **Locate Origin Server Behavior**
   - Find the **Origin Server** behavior in the **Default Rule**

7. **Set Origin Type**
   - Set **Origin Type** to `NetStorage`

8. **Select CP Code**
   - Select the **CP Code** you saved from Step 2

9. **Verify Origin Hostname**
   - The **Origin Hostname** will automatically populate based on your NetStorage configuration

10. **Configure Caching Rules**
    - Set up caching rules for optimal performance and efficiency

11. **Set Up SSL Certificate**
    - Configure SSL certificate for HTTPS support (required for production)

12. **Configure Security Headers**
    - Add security headers and CORS settings as needed for your application

13. **Enable Compression**
    - Configure compression and optimization settings

14. **Activate on Staging**
    - **First**: Activate the property on the **staging network** for testing

15. **Test and Verify**
    - **Test**: Verify content delivery, functionality, and performance
    - **Monitor**: Check edge cache behavior and response times

16. **Deploy to Production**
    - **Finally**: Activate on the **production network** when validation is complete
</div>

**Official Documentation:** 
- [Property Manager User Guide](https://techdocs.akamai.com/property-mgr/docs)
- [Creating a New Property](https://techdocs.akamai.com/property-mgr/docs/create-a-new-property)

---

## CI/CD Integration

### Automated Deployment with Akamai

**CI/CD Integration:**

For complete, production-ready CI/CD workflows and deployment automation, refer to our dedicated repositories:

- **[1fe-ci-cd Repository](https://github.com/docusign/1fe-ci-cd)** - Complete GitHub Actions workflows, deployment scripts, and automation templates
- **[Akamai Upload Action](https://github.com/docusign/1fe-ci-cd/blob/main/.github/actions/widget-upload-akamai/action.yml)** - Specific GitHub Action for uploading widget files to Akamai CDN
- **[mock-cdn-assets Repository](https://github.com/docusign/mock-cdn-assets)** - Example asset structures, directory layouts, and configuration files

### Deployment Strategy

**Environment Management:**

- **Integration environment:** `integration/` - For testing new features and integration testing
- **Production environment:** `production/` - For live user-facing deployments

**Related:** 
- See [Hosting Environment Configuration](/infrastructure/hosting-setup/#environment-configuration) for setting up corresponding hosting environments
- See [CI/CD Pipeline Setup](/infrastructure/project-setup/) for automating CDN deployments

:::tip[Deployment Flow]
<div className="prose">
1. üß™ **Deploy to integration environment first**
2. ‚úÖ **Run automated tests and manual validation**  
3. üöÄ **Deploy to production environment**
4. üìã **Update configuration manifests**
5. üìä **Monitor deployment health**
</div>
:::

:::note[Environment Separation]
Always use separate directories and credentials for different environments. This prevents accidental deployments to production and maintains proper isolation.
:::

---

## Best Practices


### Cache Configuration
- **Immutable files** (hashed): `Cache-Control: max-age=31536000, immutable`
- **Manifests**: `Cache-Control: max-age=300, must-revalidate`
- **Assets**: `Cache-Control: max-age=2592000`

## Additional Resources

### 1fe Implementation Resources
- **[1fe-ci-cd Repository](https://github.com/docusign/1fe-ci-cd)** - Complete CI/CD workflows and deployment automation
- **[mock-cdn-assets Repository](https://github.com/docusign/mock-cdn-assets)** - Example asset structures and configurations

### Akamai Resources
- **[Akamai Control Center](https://control.akamai.com/)** - Main management interface
- **[Akamai Developer Portal](https://developer.akamai.com/)** - APIs and automation tools
- **[Akamai CLI](https://github.com/akamai/cli)** - Command-line interface for automation
- **[NetStorage API Documentation](https://techdocs.akamai.com/netstorage-api/docs)** - For automated uploads and management

## Next Steps

After setting up your CDN:
1. [Set up Hosting Service for 1fe Instance](/infrastructure/hosting-setup/)
2. [Configure Configuration Service](/infrastructure/configuration-setup/)
3. [Set up NPM Registry](/infrastructure/npm-registry-setup/)
4. [Implement CI/CD Integration](/infrastructure/project-setup/) 